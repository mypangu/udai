<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta name="theme-color" content="#4ecdc4">
  <meta name="description" content="Watch Tamil TV shows and videos from multiple channels">
  <title>YouDai Connecting Tamil</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="/youdai/manifest.json">
  <link rel="icon" type="image/png" href="/youdai/icons/icon-192.png">
  
  <script src="dev.js"></script>

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
      color: #ffffff;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* TV-specific styles */
    @media screen and (min-width: 1920px) {
      body {
        font-size: 18px;
      }
    }

    /* Focus management - Critical for TV navigation */
    .focusable {
      outline: none;
      transition: all 0.2s ease;
      position: relative;
    }

    .focusable:focus,
    .focusable.focused {
      outline: 3px solid #4ecdc4;
      outline-offset: 2px;
      transform: scale(1.08);
      z-index: 50;
      box-shadow: 0 0 20px rgba(78, 205, 196, 0.6);
    }

    /* TV focus ring animation */
    @keyframes focusPulse {
      0%, 100% { 
        box-shadow: 0 0 20px rgba(78, 205, 196, 0.6);
      }
      50% { 
        box-shadow: 0 0 30px rgba(78, 205, 196, 0.8);
      }
    }

    .focusable:focus {
      animation: focusPulse 2s infinite;
    }

    /* Container */
    .container {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 10px;
    }

    @media (min-width: 768px) {
      .container {
        padding: 0 25px;
      }
    }

    @media screen and (min-width: 1920px) {
      .container {
        max-width: 1800px;
        padding: 0 40px;
      }
    }

    /* Header - TV optimized */
    header {
      background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
      padding: 12px 0;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    @media (min-width: 768px) {
      header {
        padding: 20px 0;
      }
    }

    @media screen and (min-width: 1920px) {
      header {
        padding: 30px 0;
      }
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradient 3s ease infinite;
    }

    @media (min-width: 768px) {
      header h1 {
        font-size: 28px;
      }
    }

    @media screen and (min-width: 1920px) {
      header h1 {
        font-size: 36px;
      }
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* TV Remote Help */
    .tv-help {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: #4ecdc4;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 12px;
      z-index: 1000;
      border: 1px solid rgba(78, 205, 196, 0.3);
      backdrop-filter: blur(10px);
      display: none;
    }

    @media screen and (min-width: 1920px) {
      .tv-help {
        display: block;
        font-size: 14px;
        padding: 15px 20px;
      }
    }

    .tv-help .help-item {
      margin-bottom: 5px;
    }

    .tv-help .help-item:last-child {
      margin-bottom: 0;
    }

    /* Top bar - TV optimized */
    .top-bar {
      background: rgba(30, 30, 30, 0.9);
      backdrop-filter: blur(10px);
      padding: 8px 0;
      position: sticky;
      top: 56px;
      z-index: 99;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    @media (min-width: 768px) {
      .top-bar {
        padding: 15px 0;
        top: 80px;
      }
    }

    @media screen and (min-width: 1920px) {
      .top-bar {
        padding: 20px 0;
        top: 120px;
      }
    }

    .search-filter-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    @media (min-width: 768px) {
      .search-filter-container {
        gap: 15px;
      }
    }

    @media screen and (min-width: 1920px) {
      .search-filter-container {
        gap: 25px;
      }
    }

    .search-container {
      position: relative;
      flex: 1;
    }

    .search-input {
      width: 100%;
      padding: 8px 35px 8px 12px;
      border-radius: 20px;
      border: 2px solid transparent;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 14px;
      outline: none;
      transition: all 0.3s ease;
    }

    @media (min-width: 768px) {
      .search-input {
        padding: 12px 50px 12px 20px;
        font-size: 16px;
        border-radius: 25px;
      }
    }

    @media screen and (min-width: 1920px) {
      .search-input {
        padding: 16px 60px 16px 25px;
        font-size: 20px;
        border-radius: 30px;
      }
    }

    .search-input:focus {
      border-color: #4ecdc4;
      background: rgba(255,255,255,0.15);
      box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
    }

    .search-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255,255,255,0.6);
      font-size: 14px;
    }

    @media (min-width: 768px) {
      .search-icon {
        right: 20px;
        font-size: 16px;
      }
    }

    @media screen and (min-width: 1920px) {
      .search-icon {
        right: 25px;
        font-size: 20px;
      }
    }

    /* Filter controls - TV optimized */
    .filter-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .calendar-btn {
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @media (min-width: 768px) {
      .calendar-btn {
        width: 45px;
        height: 45px;
        font-size: 18px;
      }
    }

    @media screen and (min-width: 1920px) {
      .calendar-btn {
        width: 55px;
        height: 55px;
        font-size: 22px;
      }
    }

    .calendar-btn:hover, .calendar-btn.active {
      background: #4ecdc4;
      transform: scale(1.1);
    }

    .date-input {
      position: absolute;
      top: 45px;
      right: 0;
      background: rgba(30, 30, 30, 0.95);
      border: 2px solid #4ecdc4;
      border-radius: 8px;
      padding: 8px;
      color: #fff;
      font-size: 12px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      z-index: 1000;
      min-width: 150px;
      color-scheme: dark;
    }

    @media (min-width: 768px) {
      .date-input {
        top: 55px;
        border-radius: 12px;
        padding: 12px;
        font-size: 14px;
        min-width: 200px;
      }
    }

    @media screen and (min-width: 1920px) {
      .date-input {
        top: 65px;
        padding: 16px;
        font-size: 18px;
        min-width: 250px;
      }
    }

    .clear-filters-btn {
      background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
      border: none;
      border-radius: 15px;
      padding: 6px 12px;
      color: white;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    @media (min-width: 768px) {
      .clear-filters-btn {
        border-radius: 20px;
        padding: 8px 16px;
        font-size: 14px;
      }
    }

    @media screen and (min-width: 1920px) {
      .clear-filters-btn {
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 25px;
      }
    }

    /* Channel sections - TV optimized spacing */
    .channel-sections {
      padding: 15px 0 30px;
    }

    @media (min-width: 768px) {
      .channel-sections {
        padding: 20px 0 40px;
      }
    }

    @media screen and (min-width: 1920px) {
      .channel-sections {
        padding: 30px 0 60px;
      }
    }

    .channel-section {
      margin-bottom: 15px;
    }

    @media (min-width: 768px) {
      .channel-section {
        margin-bottom: 25px;
      }
    }

    @media screen and (min-width: 1920px) {
      .channel-section {
        margin-bottom: 40px;
      }
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 0 10px;
    }

    @media (min-width: 768px) {
      .section-header {
        margin-bottom: 20px;
        padding: 0 15px;
      }
    }

    @media screen and (min-width: 1920px) {
      .section-header {
        margin-bottom: 25px;
        padding: 0 20px;
      }
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      margin: 0;
    }

    @media (min-width: 768px) {
      .section-title {
        font-size: 24px;
      }
    }

    @media screen and (min-width: 1920px) {
      .section-title {
        font-size: 32px;
      }
    }

    .section-expand {
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      border-radius: 20px;
      padding: 8px 16px;
      background: rgba(255,255,255,0.05);
    }

    @media screen and (min-width: 1920px) {
      .section-expand {
        font-size: 18px;
        padding: 12px 20px;
        gap: 10px;
      }
    }

    /* Horizontal scroll - TV optimized */
    .videos-scroll {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      scroll-behavior: smooth;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding: 0 10px 15px;
      /* TV-specific: Ensure proper focus within scroll */
      scroll-snap-type: x mandatory;
    }

    @media (min-width: 768px) {
      .videos-scroll {
        gap: 15px;
        padding: 0 15px 20px;
      }
    }

    @media screen and (min-width: 1920px) {
      .videos-scroll {
        gap: 25px;
        padding: 0 20px 30px;
      }
    }

    .videos-scroll::-webkit-scrollbar {
      display: none;
    }

    /* TV-optimized video cards */
    .video-card-horizontal {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      position: relative;
      flex-shrink: 0;
      width: 140px;
      scroll-snap-align: start;
    }

    @media (min-width: 480px) {
      .video-card-horizontal {
        width: 160px;
      }
    }

    @media (min-width: 768px) {
      .video-card-horizontal {
        width: 240px;
        border-radius: 16px;
      }
    }

    @media (min-width: 1024px) {
      .video-card-horizontal {
        width: 280px;
      }
    }

    @media screen and (min-width: 1920px) {
      .video-card-horizontal {
        width: 350px;
        border-radius: 20px;
      }
    }

    .video-card-horizontal:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      border-color: rgba(78, 205, 196, 0.5);
    }

    /* TV-optimized thumbnails */
    .card-thumbnail {
      position: relative;
      width: 100%;
      height: 80px;
      overflow: hidden;
    }

    @media (min-width: 480px) {
      .card-thumbnail {
        height: 90px;
      }
    }

    @media (min-width: 768px) {
      .card-thumbnail {
        height: 135px;
      }
    }

    @media (min-width: 1024px) {
      .card-thumbnail {
        height: 160px;
      }
    }

    @media screen and (min-width: 1920px) {
      .card-thumbnail {
        height: 200px;
      }
    }

    .card-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .play-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.7);
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #4ecdc4;
      font-size: 14px;
      opacity: 0;
      transition: all 0.3s ease;
    }

    @media (min-width: 768px) {
      .play-overlay {
        width: 50px;
        height: 50px;
        font-size: 20px;
      }
    }

    @media screen and (min-width: 1920px) {
      .play-overlay {
        width: 70px;
        height: 70px;
        font-size: 28px;
      }
    }

    .video-card-horizontal:hover .play-overlay,
    .video-card-horizontal:focus .play-overlay,
    .video-card-horizontal.focused .play-overlay {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.1);
    }

    /* Card content - TV optimized */
    .card-content {
      padding: 8px;
    }

    @media (min-width: 768px) {
      .card-content {
        padding: 16px;
      }
    }

    @media screen and (min-width: 1920px) {
      .card-content {
        padding: 20px;
      }
    }

    .card-title {
      font-size: 12px;
      font-weight: 600;
      line-height: 1.3;
      margin: 0 0 4px 0;
      color: #fff;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .card-title {
        font-size: 14px;
        margin: 0 0 8px 0;
        line-height: 1.4;
      }
    }

    @media screen and (min-width: 1920px) {
      .card-title {
        font-size: 18px;
        margin: 0 0 12px 0;
        -webkit-line-clamp: 3;
      }
    }

    .card-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 10px;
      color: rgba(255,255,255,0.6);
    }

    @media (min-width: 768px) {
      .card-meta {
        font-size: 12px;
      }
    }

    @media screen and (min-width: 1920px) {
      .card-meta {
        font-size: 14px;
      }
    }

    /* Grid layout - TV optimized */
    .video-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      padding: 15px 10px;
    }

    @media (min-width: 480px) {
      .video-grid {
        gap: 12px;
        padding: 15px;
      }
    }

    @media (min-width: 768px) {
      .video-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        padding: 20px 25px;
      }
    }

    @media (min-width: 1200px) {
      .video-grid {
        grid-template-columns: repeat(5, 1fr);
        gap: 25px;
        padding: 20px 40px;
      }
    }

    @media screen and (min-width: 1920px) {
      .video-grid {
        grid-template-columns: repeat(6, 1fr);
        gap: 30px;
        padding: 30px 60px;
      }
    }

    /* Grid cards - TV optimized */
    .video-card-grid {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      position: relative;
    }

    @media (min-width: 768px) {
      .video-card-grid {
        border-radius: 16px;
      }
    }

    @media screen and (min-width: 1920px) {
      .video-card-grid {
        border-radius: 20px;
      }
    }

    .video-card-grid:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      border-color: rgba(78, 205, 196, 0.5);
    }

    @media (min-width: 768px) {
      .video-card-grid:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      }
    }

    @media screen and (min-width: 1920px) {
      .video-card-grid:hover {
        transform: translateY(-10px) scale(1.05);
        box-shadow: 0 25px 50px rgba(0,0,0,0.4);
      }
    }

    /* Grid thumbnails */
    .video-card-grid .card-thumbnail {
      aspect-ratio: 16 / 9;
      height: auto;
    }

    .channel-tag {
      position: absolute;
      top: 6px;
      right: 6px;
      background: rgba(0,0,0,0.8);
      color: #4ecdc4;
      padding: 3px 6px;
      border-radius: 8px;
      font-size: 10px;
      font-weight: 600;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(78, 205, 196, 0.3);
    }

    @media (min-width: 768px) {
      .channel-tag {
        top: 8px;
        right: 8px;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
      }
    }

    @media screen and (min-width: 1920px) {
      .channel-tag {
        top: 12px;
        right: 12px;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 14px;
      }
    }

    /* Loading animation */
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #4ecdc4;
      animation: spin 1s ease-in-out infinite;
    }

    @media (min-width: 768px) {
      .loading {
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255,255,255,0.3);
      }
    }

    @media screen and (min-width: 1920px) {
      .loading {
        width: 24px;
        height: 24px;
        border: 4px solid rgba(255,255,255,0.3);
      }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* No results - TV optimized */
    .no-results {
      text-align: center;
      padding: 40px 15px;
      color: rgba(255,255,255,0.6);
    }

    @media (min-width: 768px) {
      .no-results {
        padding: 60px 20px;
      }
    }

    @media screen and (min-width: 1920px) {
      .no-results {
        padding: 80px 30px;
      }
    }

    .no-results i {
      font-size: 48px;
      margin-bottom: 15px;
      color: rgba(255,255,255,0.3);
    }

    @media (min-width: 768px) {
      .no-results i {
        font-size: 64px;
        margin-bottom: 20px;
      }
    }

    @media screen and (min-width: 1920px) {
      .no-results i {
        font-size: 80px;
        margin-bottom: 30px;
      }
    }

    .no-results h3 {
      font-size: 18px;
      margin: 0 0 8px 0;
      color: rgba(255,255,255,0.8);
    }

    @media (min-width: 768px) {
      .no-results h3 {
        font-size: 24px;
        margin: 0 0 10px 0;
      }
    }

    @media screen and (min-width: 1920px) {
      .no-results h3 {
        font-size: 30px;
        margin: 0 0 15px 0;
      }
    }

    .no-results p {
      font-size: 14px;
      margin: 0;
    }

    @media (min-width: 768px) {
      .no-results p {
        font-size: 16px;
      }
    }

    @media screen and (min-width: 1920px) {
      .no-results p {
        font-size: 20px;
      }
    }

    /* Back button - TV optimized */
    .back-home-btn {
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: 15px;
      padding: 6px 12px;
      color: #fff;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    @media (min-width: 768px) {
      .back-home-btn {
        border-radius: 20px;
        padding: 8px 16px;
        font-size: 14px;
        gap: 8px;
      }
    }

    @media screen and (min-width: 1920px) {
      .back-home-btn {
        border-radius: 25px;
        padding: 12px 20px;
        font-size: 18px;
        gap: 10px;
      }
    }

    /* Go to top - TV optimized */
    .go-to-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #4ecdc4, #45b7d1);
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      z-index: 1000;
      transition: all 0.3s ease;
      opacity: 0;
      visibility: hidden;
      transform: scale(0.8);
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @media (min-width: 768px) {
      .go-to-top {
        bottom: 30px;
        right: 30px;
        width: 55px;
        height: 55px;
        font-size: 20px;
        box-shadow: 0 4px 20px rgba(78, 205, 196, 0.3);
      }
    }

    @media screen and (min-width: 1920px) {
      .go-to-top {
        bottom: 40px;
        right: 40px;
        width: 70px;
        height: 70px;
        font-size: 24px;
      }
    }

    .go-to-top.visible {
      opacity: 1;
      visibility: visible;
      transform: scale(1);
    }

    .go-to-top:hover {
      background: linear-gradient(135deg, #45b7d1, #4ecdc4);
      transform: scale(1.1);
    }

    /* Grid headers - TV optimized */
    .grid-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 25px 0 15px 0;
      padding: 0 10px;
    }

    @media (min-width: 768px) {
      .grid-header {
        margin: 40px 0 20px 0;
        padding: 0 25px;
      }
    }

    @media screen and (min-width: 1920px) {
      .grid-header {
        margin: 50px 0 30px 0;
        padding: 0 40px;
      }
    }

    /* Hidden utility */
    .hidden {
      display: none!important;
    }

    /* Scroll buttons - TV optimized */
    .scroll-btn {
      display: none;
    }

    @media (min-width: 768px) {
      .scroll-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0,0,0,0.8);
        border: none;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        color: #fff;
        font-size: 18px;
        cursor: pointer;
        z-index: 10;
        transition: all 0.3s ease;
      }

      .scroll-btn:hover {
        background: rgba(78, 205, 196, 0.9);
        transform: translateY(-50%) scale(1.1);
      }

      .scroll-btn.left {
        left: 10px;
      }

      .scroll-btn.right {
        right: 10px;
      }

      .videos-container:hover .scroll-btn {
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }

    @media screen and (min-width: 1920px) {
      .scroll-btn {
        width: 60px;
        height: 60px;
        font-size: 24px;
      }

      .scroll-btn.left {
        left: 15px;
      }

      .scroll-btn.right {
        right: 15px;
      }
    }

    /* TV Navigation Indicator */
    .nav-indicator {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #4ecdc4;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      z-index: 1000;
      border: 1px solid rgba(78, 205, 196, 0.3);
      backdrop-filter: blur(10px);
      display: none;
      text-align: center;
    }

    @media screen and (min-width: 1920px) {
      .nav-indicator {
        display: block;
        font-size: 14px;
        padding: 12px 20px;
      }
    }

    /* Optimize scrollbars for TV */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(78, 205, 196, 0.4);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(78, 205, 196, 0.6);
    }

    @media (min-width: 768px) {
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(255,255,255,0.1);
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(78, 205, 196, 0.6);
        border-radius: 4px;
      }
    }

    @media screen and (min-width: 1920px) {
      ::-webkit-scrollbar {
        width: 12px;
        height: 12px;
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(78, 205, 196, 0.7);
        border-radius: 6px;
      }
    }

    /* Loading and error states */
    .loading-state {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      color: rgba(255,255,255,0.7);
      gap: 10px;
    }

    @media screen and (min-width: 1920px) {
      .loading-state {
        padding: 60px 30px;
        gap: 15px;
        font-size: 20px;
      }
    }

    .error-state {
      text-align: center;
      padding: 40px 20px;
      color: rgba(255, 107, 107, 0.8);
    }

    @media screen and (min-width: 1920px) {
      .error-state {
        padding: 60px 30px;
      }
    }

    .error-state i {
      font-size: 48px;
      margin-bottom: 15px;
    }

    @media screen and (min-width: 1920px) {
      .error-state i {
        font-size: 64px;
        margin-bottom: 20px;
      }
    }

    .error-state h3 {
      font-size: 18px;
      margin: 0 0 8px 0;
    }

    @media screen and (min-width: 1920px) {
      .error-state h3 {
        font-size: 24px;
        margin: 0 0 12px 0;
      }
    }

    .error-state p {
      font-size: 14px;
      margin: 0;
      opacity: 0.8;
    }

    @media screen and (min-width: 1920px) {
      .error-state p {
        font-size: 18px;
      }
    }

    .error-state button {
      margin-top: 15px;
      padding: 8px 16px;
      background: #4ecdc4;
      border: none;
      border-radius: 20px;
      color: white;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    @media screen and (min-width: 1920px) {
      .error-state button {
        margin-top: 20px;
        padding: 12px 24px;
        font-size: 18px;
        border-radius: 25px;
      }
    }

    .error-state button:hover,
    .error-state button:focus {
      background: #45b7d1;
      transform: scale(1.05);
    }

    /* TV-specific focus improvements */
    @media screen and (min-width: 1920px) {
      .focusable:focus {
        outline: 4px solid #4ecdc4;
        outline-offset: 3px;
        transform: scale(1.1);
        z-index: 50;
        box-shadow: 0 0 30px rgba(78, 205, 196, 0.8);
      }
    }

    /* TV Remote Control Styles */
    .tv-controls {
      position: fixed;
      top: 50%;
      left: 20px;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.9);
      border: 2px solid rgba(78, 205, 196, 0.3);
      border-radius: 15px;
      padding: 20px;
      z-index: 2000;
      backdrop-filter: blur(10px);
      display: none;
      flex-direction: column;
      gap: 15px;
      color: #4ecdc4;
      font-size: 14px;
    }

    @media screen and (min-width: 1920px) {
      .tv-controls {
        display: flex;
      }
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .control-label {
      font-weight: 600;
      color: #fff;
      font-size: 16px;
      margin-bottom: 5px;
    }

    .control-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
    }

    .control-key {
      background: rgba(78, 205, 196, 0.2);
      border: 1px solid rgba(78, 205, 196, 0.5);
      border-radius: 4px;
      padding: 4px 8px;
      font-family: monospace;
      font-size: 11px;
      min-width: 30px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- TV Remote Help -->
  <div class="tv-help">
    <div class="help-item"><strong>↑↓←→</strong> Navigate</div>
    <div class="help-item"><strong>Enter</strong> Select</div>
    <div class="help-item"><strong>Back</strong> Go Back</div>
    <div class="help-item"><strong>Home</strong> Home</div>
  </div>

  <!-- TV Controls Panel -->
  <div class="tv-controls" id="tvControls">
    <div class="control-group">
      <div class="control-label">Navigation</div>
      <div class="control-item">
        <span class="control-key">↑↓←→</span>
        <span>Move between items</span>
      </div>
      <div class="control-item">
        <span class="control-key">Enter</span>
        <span>Select/Play video</span>
      </div>
    </div>
    <div class="control-group">
      <div class="control-label">Actions</div>
      <div class="control-item">
        <span class="control-key">Back</span>
        <span>Go back/Exit search</span>
      </div>
      <div class="control-item">
        <span class="control-key">Home</span>
        <span>Return to main view</span>
      </div>
    </div>
    <div class="control-group">
      <div class="control-label">Shortcuts</div>
      <div class="control-item">
        <span class="control-key">/</span>
        <span>Focus search</span>
      </div>
      <div class="control-item">
        <span class="control-key">Esc</span>
        <span>Clear search/Close</span>
      </div>
    </div>
  </div>

  <!-- Navigation Indicator -->
  <div class="nav-indicator" id="navIndicator">
    Use arrow keys to navigate • Enter to select
  </div>

  <header>
    <div class="container">
      <h1>🎬 YouDai</h1>
    </div>
  </header>

  <div class="top-bar">
    <div class="container">
      <div class="search-filter-container">
        <div class="search-container">
          <input type="text" id="searchBox" class="search-input focusable" placeholder="Search videos..." tabindex="1">
          <i class="fas fa-search search-icon"></i>
        </div>
        
        <div class="filter-controls">
          <div class="date-filter-container">
            <button class="calendar-btn focusable" id="calendarBtn" tabindex="2">
              <i class="fas fa-calendar-alt"></i>
            </button>
            <input type="date" id="dateFilter" class="date-input focusable" style="display: none;" tabindex="3">
          </div>
          <button class="clear-filters-btn focusable" id="clearFilters" style="display: none;" tabindex="4">
            <i class="fas fa-times"></i> Clear
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Loading state -->
    <div class="loading-state" id="loadingState">
      <div class="loading"></div>
      <span>Loading videos...</span>
    </div>

    <!-- Error state -->
    <div class="error-state hidden" id="errorState">
      <i class="fas fa-exclamation-triangle"></i>
      <h3>Failed to load videos</h3>
      <p>Please check your connection and try again</p>
      <button class="focusable" onclick="window.location.reload()" tabindex="1">Retry</button>
    </div>

    <!-- Channel sections view -->
    <div class="channel-sections hidden" id="channelSections"></div>
    
    <!-- Grid view for single channel -->
    <div class="video-grid-container hidden" id="videoGridContainer">
      <div class="grid-header">
        <h2 class="section-title" id="gridTitle"></h2>
        <button class="back-home-btn focusable" id="backButton" tabindex="1">
          <i class="fas fa-home"></i> Back Home
        </button>
      </div>
      <div class="video-grid" id="videoGrid"></div>
    </div>
    
    <!-- Search results -->
    <div class="search-results hidden" id="searchResults">
      <h2 class="section-title" id="searchTitle">Search Results</h2>
      <div class="video-grid" id="searchGrid"></div>
    </div>
  </div>

  <!-- Go to Top Button -->
  <button class="go-to-top focusable" id="goToTopBtn">
    <i class="fas fa-chevron-up"></i>
  </button>

  <script>
    let videos = [];
    let isLoading = false;

    // TV Navigation State
    let focusedElement = null;
    let focusGrid = [];
    let currentFocusRow = 0;
    let currentFocusCol = 0;
    let isNavigating = false;

    // DOM elements
    const elements = {
      loadingState: document.getElementById("loadingState"),
      errorState: document.getElementById("errorState"),
      channelSections: document.getElementById("channelSections"),
      videoGridContainer: document.getElementById("videoGridContainer"),
      videoGrid: document.getElementById("videoGrid"),
      searchResults: document.getElementById("searchResults"),
      searchGrid: document.getElementById("searchGrid"),
      searchBox: document.getElementById("searchBox"),
      calendarBtn: document.getElementById("calendarBtn"),
      dateFilter: document.getElementById("dateFilter"),
      clearFilters: document.getElementById("clearFilters"),
      backButton: document.getElementById("backButton"),
      gridTitle: document.getElementById("gridTitle"),
      searchTitle: document.getElementById("searchTitle"),
      goToTopBtn: document.getElementById("goToTopBtn"),
      navIndicator: document.getElementById("navIndicator"),
      tvControls: document.getElementById("tvControls")
    };

    let currentView = 'loading';
    let currentChannel = null;
    let isDatePickerVisible = false;

    // TV Detection
    function isTVDevice() {
      const userAgent = navigator.userAgent.toLowerCase();
      return userAgent.includes('tv') || 
             userAgent.includes('googletv') || 
             userAgent.includes('android tv') ||
             window.screen.width >= 1920 ||
             navigator.maxTouchPoints === 0;
    }

    // TV Navigation Manager
    class TVNavigationManager {
      constructor() {
        this.isActive = isTVDevice();
        this.currentFocusIndex = 0;
        this.focusableElements = [];
        this.navigationMode = 'linear'; // 'linear' or 'grid'
        this.gridDimensions = { rows: 0, cols: 0 };
        this.currentPosition = { row: 0, col: 0 };
      }

      initialize() {
        if (!this.isActive) return;
        
        this.setupKeyboardNavigation();
        this.updateNavigationIndicator();
        
        // Auto-focus first element when view changes
        setTimeout(() => this.focusFirst(), 100);
      }

      setupKeyboardNavigation() {
        document.addEventListener('keydown', (e) => this.handleKeyNavigation(e));
        
        // Handle gamepad if available
        if (navigator.getGamepads) {
          this.setupGamepadNavigation();
        }
      }

      handleKeyNavigation(e) {
        if (!this.isActive) return;

        const { key, keyCode } = e;
        
        switch (key) {
          case 'ArrowUp':
            e.preventDefault();
            this.navigateUp();
            break;
          case 'ArrowDown':
            e.preventDefault();
            this.navigateDown();
            break;
          case 'ArrowLeft':
            e.preventDefault();
            this.navigateLeft();
            break;
          case 'ArrowRight':
            e.preventDefault();
            this.navigateRight();
            break;
          case 'Enter':
            e.preventDefault();
            this.activateCurrentElement();
            break;
          case 'Escape':
            e.preventDefault();
            this.handleEscape();
            break;
          case 'Backspace':
            e.preventDefault();
            this.handleBack();
            break;
          case '/':
            e.preventDefault();
            this.focusSearch();
            break;
          case 'Home':
            e.preventDefault();
            this.goHome();
            break;
        }

        // Handle Android TV specific keys
        switch (keyCode) {
          case 4: // Android back button
            e.preventDefault();
            this.handleBack();
            break;
          case 3: // Android home button
            e.preventDefault();
            this.goHome();
            break;
          case 21: // DPAD_LEFT
            e.preventDefault();
            this.navigateLeft();
            break;
          case 22: // DPAD_RIGHT
            e.preventDefault();
            this.navigateRight();
            break;
          case 19: // DPAD_UP
            e.preventDefault();
            this.navigateUp();
            break;
          case 20: // DPAD_DOWN
            e.preventDefault();
            this.navigateDown();
            break;
          case 23: // DPAD_CENTER
          case 66: // ENTER
            e.preventDefault();
            this.activateCurrentElement();
            break;
        }
      }

      updateFocusableElements() {
        this.focusableElements = Array.from(document.querySelectorAll('.focusable:not(.hidden)'))
          .filter(el => {
            const rect = el.getBoundingClientRect();
            return rect.width > 0 && rect.height > 0; // Only visible elements
          });
        
        this.detectNavigationMode();
      }

      detectNavigationMode() {
        // Check if we're in a grid layout
        const videoCards = document.querySelectorAll('.video-card-grid:not(.hidden), .video-card-horizontal:not(.hidden)');
        
        if (videoCards.length > 0) {
          this.navigationMode = 'grid';
          this.calculateGridDimensions();
        } else {
          this.navigationMode = 'linear';
        }
      }

      calculateGridDimensions() {
        const container = document.querySelector('.video-grid:not(.hidden), .videos-scroll:not(.hidden)');
        if (!container) return;

        const cards = Array.from(container.querySelectorAll('.video-card-grid, .video-card-horizontal'));
        if (cards.length === 0) return;

        if (container.classList.contains('videos-scroll')) {
          // Horizontal scroll - single row
          this.gridDimensions = { rows: 1, cols: cards.length };
        } else {
          // Grid layout - calculate from CSS grid
          const computedStyle = window.getComputedStyle(container);
          const columns = computedStyle.gridTemplateColumns.split(' ').length;
          this.gridDimensions = {
            cols: columns,
            rows: Math.ceil(cards.length / columns)
          };
        }
      }

      navigateUp() {
        if (this.navigationMode === 'grid') {
          this.moveInGrid('up');
        } else {
          this.moveFocusBy(-1);
        }
      }

      navigateDown() {
        if (this.navigationMode === 'grid') {
          this.moveInGrid('down');
        } else {
          this.moveFocusBy(1);
        }
      }

      navigateLeft() {
        if (this.navigationMode === 'grid') {
          this.moveInGrid('left');
        } else {
          this.moveFocusBy(-1);
        }
      }

      navigateRight() {
        if (this.navigationMode === 'grid') {
          this.moveInGrid('right');
        } else {
          this.moveFocusBy(1);
        }
      }

      moveInGrid(direction) {
        const { row, col } = this.currentPosition;
        const { rows, cols } = this.gridDimensions;
        
        let newRow = row;
        let newCol = col;

        switch (direction) {
          case 'up':
            newRow = Math.max(0, row - 1);
            break;
          case 'down':
            newRow = Math.min(rows - 1, row + 1);
            break;
          case 'left':
            newCol = Math.max(0, col - 1);
            break;
          case 'right':
            newCol = Math.min(cols - 1, col + 1);
            break;
        }

        const targetIndex = newRow * cols + newCol;
        if (targetIndex < this.focusableElements.length) {
          this.currentPosition = { row: newRow, col: newCol };
          this.setFocus(targetIndex);
        }
      }

      moveFocusBy(delta) {
        this.updateFocusableElements();
        
        if (this.focusableElements.length === 0) return;
        
        let newIndex = this.currentFocusIndex + delta;
        
        if (newIndex < 0) {
          newIndex = this.focusableElements.length - 1;
        } else if (newIndex >= this.focusableElements.length) {
          newIndex = 0;
        }
        
        this.setFocus(newIndex);
      }

      setFocus(index) {
        this.updateFocusableElements();
        
        if (index < 0 || index >= this.focusableElements.length) return;

        // Remove previous focus
        if (focusedElement) {
          focusedElement.classList.remove('focused');
          focusedElement.blur();
        }

        // Set new focus
        this.currentFocusIndex = index;
        focusedElement = this.focusableElements[index];
        
        if (focusedElement) {
          focusedElement.classList.add('focused');
          focusedElement.focus();
          this.scrollToElement(focusedElement);
          this.updateNavigationIndicator();
        }
      }

      scrollToElement(element) {
        const rect = element.getBoundingClientRect();
        const isInViewport = rect.top >= 0 && rect.bottom <= window.innerHeight;
        
        if (!isInViewport) {
          element.scrollIntoView({
            behavior: 'smooth',
            block: 'center',
            inline: 'center'
          });
        }
      }

      focusFirst() {
        this.updateFocusableElements();
        if (this.focusableElements.length > 0) {
          this.setFocus(0);
        }
      }

      activateCurrentElement() {
        if (focusedElement) {
          focusedElement.click();
        }
      }

      handleEscape() {
        if (isDatePickerVisible) {
          hideDatePicker();
        } else if (elements.searchBox.value || elements.dateFilter.value) {
          clearAllFilters();
        }
      }

      handleBack() {
        if (currentView === 'grid' || currentView === 'search') {
          backToSections();
        } else if (elements.searchBox.value || elements.dateFilter.value) {
          clearAllFilters();
        }
      }

      focusSearch() {
        elements.searchBox.focus();
        this.updateFocusableElements();
        const searchIndex = this.focusableElements.indexOf(elements.searchBox);
        if (searchIndex !== -1) {
          this.setFocus(searchIndex);
        }
      }

      goHome() {
        if (currentView !== 'sections') {
          backToSections();
        }
      }

      updateNavigationIndicator() {
        if (!this.isActive || !elements.navIndicator) return;
        
        let text = 'Use arrow keys to navigate • Enter to select';
        
        if (currentView === 'sections') {
          text = 'Navigate sections • Enter to view all • Search with /';
        } else if (currentView === 'grid') {
          text = 'Browse videos • Enter to play • Back to go home';
        } else if (currentView === 'search') {
          text = 'Search results • Enter to play • Esc to clear';
        }
        
        elements.navIndicator.textContent = text;
      }

      setupGamepadNavigation() {
        let gamepadIndex = null;
        
        window.addEventListener('gamepadconnected', (e) => {
          gamepadIndex = e.gamepad.index;
          console.log('Gamepad connected:', e.gamepad.id);
        });

        window.addEventListener('gamepaddisconnected', (e) => {
          if (e.gamepad.index === gamepadIndex) {
            gamepadIndex = null;
          }
        });

        // Poll gamepad state
        const pollGamepad = () => {
          if (gamepadIndex !== null) {
            const gamepad = navigator.getGamepads()[gamepadIndex];
            if (gamepad) {
              this.handleGamepadInput(gamepad);
            }
          }
          requestAnimationFrame(pollGamepad);
        };
        
        pollGamepad();
      }

      handleGamepadInput(gamepad) {
        const threshold = 0.5;
        
        // D-pad or left stick
        if (gamepad.buttons[12] && gamepad.buttons[12].pressed) { // D-pad up
          this.navigateUp();
        }
        if (gamepad.buttons[13] && gamepad.buttons[13].pressed) { // D-pad down
          this.navigateDown();
        }
        if (gamepad.buttons[14] && gamepad.buttons[14].pressed) { // D-pad left
          this.navigateLeft();
        }
        if (gamepad.buttons[15] && gamepad.buttons[15].pressed) { // D-pad right
          this.navigateRight();
        }
        
        // A button (select)
        if (gamepad.buttons[0] && gamepad.buttons[0].pressed) {
          this.activateCurrentElement();
        }
        
        // B button (back)
        if (gamepad.buttons[1] && gamepad.buttons[1].pressed) {
          this.handleBack();
        }
      }
    }

    // Initialize TV Navigation
    const tvNav = new TVNavigationManager();

    // Initialize the app
    async function init() {
      registerServiceWorker();
      await loadVideos();
      setupEventListeners();
      tvNav.initialize();
    }

    // Register service worker for PWA
    async function registerServiceWorker() {
      if ('serviceWorker' in navigator) {
        try {
          const registration = await navigator.serviceWorker.register('/youdai/service-worker.js');
          console.log('SW registered:', registration);
        } catch (error) {
          console.log('SW registration failed:', error);
        }
      }
    }

    // Load videos from external JSON
    async function loadVideos() {
      if (isLoading) return;
      isLoading = true;
      
      showLoadingState();
      
      try {
        const response = await fetch('/youdai/videos.json');
        if (!response.ok) throw new Error('Network response was not ok');
        
        videos = await response.json();
        
        if (!Array.isArray(videos) || videos.length === 0) {
          throw new Error('Invalid video data');
        }

        hideLoadingState();
        renderChannelSections();
        showView('sections');
      } catch (error) {
        console.error('Failed to load videos:', error);
        showErrorState();
      } finally {
        isLoading = false;
      }
    }

    // State management
    function showLoadingState() {
      elements.loadingState.classList.remove('hidden');
      elements.errorState.classList.add('hidden');
      elements.channelSections.classList.add('hidden');
      elements.videoGridContainer.classList.add('hidden');
      elements.searchResults.classList.add('hidden');
    }

    function hideLoadingState() {
      elements.loadingState.classList.add('hidden');
    }

    function showErrorState() {
      elements.errorState.classList.remove('hidden');
      elements.loadingState.classList.add('hidden');
      elements.channelSections.classList.add('hidden');
      elements.videoGridContainer.classList.add('hidden');
      elements.searchResults.classList.add('hidden');
      
      // Focus retry button for TV
      setTimeout(() => {
        if (tvNav.isActive) {
          tvNav.focusFirst();
        }
      }, 100);
    }

    // Event listeners
    function setupEventListeners() {
      elements.searchBox.addEventListener("input", debounce(handleSearch, 300));
      elements.dateFilter.addEventListener("change", handleSearch);
      elements.clearFilters.addEventListener("click", clearAllFilters);
      elements.calendarBtn.addEventListener("click", toggleDatePicker);
      elements.backButton.addEventListener("click", backToSections);
      elements.goToTopBtn.addEventListener("click", scrollToTop);
      
      window.addEventListener("scroll", throttle(handleScroll, 100));
      document.addEventListener("click", handleOutsideClick);
      document.addEventListener("keydown", handleKeyDown);
      window.addEventListener("orientationchange", handleOrientationChange);

      // TV-specific event listeners
      elements.searchBox.addEventListener('focus', () => {
        if (tvNav.isActive) {
          elements.navIndicator.textContent = 'Type to search • Esc to exit search';
        }
      });

      elements.searchBox.addEventListener('blur', () => {
        tvNav.updateNavigationIndicator();
      });
    }

    // Utility functions
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    function throttle(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        if (!timeout) {
          timeout = setTimeout(() => {
            timeout = null;
            func(...args);
          }, wait);
        }
      };
    }

    function getOptimalThumbnail(video) {
      return window.innerWidth < 768 ? video.mthumb : video.dthumb;
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-IN', { 
        day: 'numeric', 
        month: 'short',
        year: 'numeric'
      });
    }

    function sortVideosByDate(videos) {
      return [...videos].sort((a, b) => new Date(b.date) - new Date(a.date));
    }

    // Event handlers
    function handleOutsideClick(e) {
      if (!e.target.closest('.date-filter-container')) {
        hideDatePicker();
      }
    }

    function handleKeyDown(e) {
      if (e.key === "Escape" && isDatePickerVisible) {
        hideDatePicker();
      }
    }

    function handleOrientationChange() {
      setTimeout(() => {
        if (currentView === 'sections') {
          renderChannelSections();
        }
        // Update TV navigation after orientation change
        if (tvNav.isActive) {
          setTimeout(() => tvNav.updateFocusableElements(), 200);
        }
      }, 100);
    }

    // Scroll functionality
    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    function handleScroll() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      elements.goToTopBtn.classList.toggle('visible', scrollTop > 300);
    }

    // Date picker functions
    function toggleDatePicker() {
      isDatePickerVisible ? hideDatePicker() : showDatePicker();
    }

    function showDatePicker() {
      elements.dateFilter.style.display = 'block';
      elements.calendarBtn.classList.add('active');
      isDatePickerVisible = true;
      setTimeout(() => {
        elements.dateFilter.focus();
        if (tvNav.isActive) {
          tvNav.updateFocusableElements();
          const dateIndex = tvNav.focusableElements.indexOf(elements.dateFilter);
          if (dateIndex !== -1) {
            tvNav.setFocus(dateIndex);
          }
        }
      }, 100);
    }

    function hideDatePicker() {
      elements.dateFilter.style.display = 'none';
      elements.calendarBtn.classList.remove('active');
      isDatePickerVisible = false;
      if (tvNav.isActive) {
        tvNav.updateFocusableElements();
      }
    }

    // Search and filter functions
    function handleSearch() {
      const query = elements.searchBox.value.toLowerCase().trim();
      const dateVal = elements.dateFilter.value;
      
      if (!query && !dateVal) {
        backToSections();
        return;
      }

      let filtered = videos;

      if (query) {
        filtered = filtered.filter(v => 
          v.title.toLowerCase().includes(query) ||
          v.channel.toLowerCase().includes(query)
        );
      }

      if (dateVal) {
        filtered = filtered.filter(v => v.date === dateVal);
        hideDatePicker();
      }

      elements.clearFilters.style.display = 'block';
      showSearchResults(filtered, query, dateVal);
    }

    function clearAllFilters() {
      elements.searchBox.value = '';
      elements.dateFilter.value = '';
      elements.clearFilters.style.display = 'none';
      hideDatePicker();
      backToSections();
    }

    // View management with TV navigation updates
    function showView(view) {
      // Hide loading and error states first
      elements.loadingState.classList.add('hidden');
      elements.errorState.classList.add('hidden');
      
      // Then manage main views
      elements.channelSections.classList.toggle('hidden', view !== 'sections');
      elements.videoGridContainer.classList.toggle('hidden', view !== 'grid');
      elements.searchResults.classList.toggle('hidden', view !== 'search');
      currentView = view;

      // Update TV navigation
      if (tvNav.isActive) {
        setTimeout(() => {
          tvNav.updateFocusableElements();
          tvNav.updateNavigationIndicator();
          tvNav.focusFirst();
        }, 100);
      }
    }

    function backToSections() {
      showView('sections');
      currentChannel = null;
      scrollToTop();
    }

    function showChannelGrid(channel) {
      const channelVideos = videos.filter(v => v.channel === channel);
      const sortedVideos = sortVideosByDate(channelVideos);
      elements.gridTitle.textContent = `${channel} Shows`;
      renderVideoGrid(sortedVideos, elements.videoGrid, false);
      currentChannel = channel;
      showView('grid');
      scrollToTop();
    }

    function showSearchResults(filteredVideos, query, dateVal) {
      let title = 'Search Results';
      if (query && dateVal) {
        title = `Results for "${query}" on ${formatDate(dateVal)}`;
      } else if (query) {
        title = `Results for "${query}"`;
      } else if (dateVal) {
        title = `Videos from ${formatDate(dateVal)}`;
      }
      
      elements.searchTitle.textContent = title;
      const sortedResults = sortVideosByDate(filteredVideos);
      renderVideoGrid(sortedResults, elements.searchGrid, true);
      showView('search');
      scrollToTop();
    }

    // Navigation
    function openPlayer(platform, videoId, video) {
      const playerData = {
        platform: platform,
        id: videoId,
        title: video.title,
        channel: video.channel,
        date: video.date,
        dthumb: video.dthumb,
        mthumb: video.mthumb
      };
      
      try {
        sessionStorage.setItem('currentVideo', JSON.stringify(playerData));
        sessionStorage.setItem('allVideos', JSON.stringify(videos));
        window.location.href = `tv_player.html`;
      } catch (e) {
        // Fallback if sessionStorage fails
        console.warn('SessionStorage not available, using URL parameters');
        const params = new URLSearchParams({
          platform: platform,
          id: videoId,
          title: video.title,
          channel: video.channel
        });
        window.location.href = `tv_player.html?${params.toString()}`;
      }
    }

    // Rendering functions with TV navigation support
    function renderChannelSections() {
      if (!videos.length) return;

      const channelOrder = ['Live TV', 'VIJAY TV', 'ZEETAMIL TV', 'SUN TV', 'THANTHI ONE', 'JAYA TV', 'KALAIGNAR TV'];
      const allChannels = [...new Set(videos.map(v => v.channel))];
      
      const orderedChannels = [
        ...channelOrder.filter(channel => allChannels.includes(channel)),
        ...allChannels.filter(channel => !channelOrder.includes(channel))
      ];
      
      let tabIndex = 5; // Start after search controls
      
      const sectionsHTML = orderedChannels.map((channel, sectionIndex) => {
        const channelVideos = videos.filter(v => v.channel === channel);
        const sortedChannelVideos = sortVideosByDate(channelVideos);
        const channelId = channel.replace(/\s+/g, '');
        
        return `
          <div class="channel-section" data-channel="${channel}">
            <div class="section-header">
              <h2 class="section-title">${channel} Shows</h2>
              <div class="section-actions">
                <button class="section-expand focusable" onclick="showChannelGrid('${channel}')" tabindex="${tabIndex++}">
                  <span>View All</span>
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
            <div class="videos-container">
              <div class="videos-scroll" id="scroll-${channelId}">
                ${sortedChannelVideos.map((video, index) => `
                  <div class="video-card-horizontal focusable" data-platform="${video.platform}" data-id="${video.id}" tabindex="${tabIndex++}">
                    <div class="card-thumbnail">
                      <img src="${getOptimalThumbnail(video)}" alt="${video.title}" loading="lazy" onerror="handleImageError(this)">
                      <div class="play-overlay">
                        <i class="fas fa-play"></i>
                      </div>
                    </div>
                    <div class="card-content">
                      <h3 class="card-title">${video.title}</h3>
                      <div class="card-meta">
                        <span class="card-date">${formatDate(video.date)}</span>
                      </div>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `;
      }).join('');

      elements.channelSections.innerHTML = sectionsHTML;
      attachVideoCardListeners(elements.channelSections, '.video-card-horizontal');
      
      // Update TV navigation after rendering
      if (tvNav.isActive) {
        setTimeout(() => tvNav.updateFocusableElements(), 100);
      }
    }

    function renderVideoGrid(videoList, container, showChannelTags) {
      if (videoList.length === 0) {
        container.innerHTML = `
          <div class="no-results" style="grid-column: 1 / -1;">
            <i class="fas fa-search"></i>
            <h3>No videos found</h3>
            <p>Try adjusting your search criteria or filters</p>
          </div>
        `;
        return;
      }

      let tabIndex = currentView === 'grid' ? 2 : 5; // After back button or search controls

      container.innerHTML = videoList.map((video, index) => `
        <div class="video-card-grid focusable" data-platform="${video.platform}" data-id="${video.id}" tabindex="${tabIndex++}">
          <div class="card-thumbnail">
            <img src="${getOptimalThumbnail(video)}" alt="${video.title}" loading="lazy" onerror="handleImageError(this)">
            ${showChannelTags ? `<span class="channel-tag">${video.channel}</span>` : ''}
            <div class="play-overlay">
              <i class="fas fa-play"></i>
            </div>
          </div>
          <div class="card-content">
            <h3 class="card-title">${video.title}</h3>
            <div class="card-meta">
              <span class="card-date">${formatDate(video.date)}</span>
            </div>
          </div>
        </div>
      `).join('');

      attachVideoCardListeners(container, '.video-card-grid');
      
      // Update TV navigation after rendering
      if (tvNav.isActive) {
        setTimeout(() => tvNav.updateFocusableElements(), 100);
      }
    }

    function attachVideoCardListeners(container, selector) {
      // Use event delegation for better performance
      container.addEventListener('click', (e) => {
        const card = e.target.closest(selector);
        if (!card) return;
        
        e.preventDefault();
        const platform = card.dataset.platform;
        const id = card.dataset.id;
        const video = videos.find(v => v.platform === platform && v.id === id);
        
        if (video) {
          openPlayer(platform, id, video);
        }
      });

      // TV navigation: Handle Enter key on video cards
      container.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          const card = e.target.closest(selector);
          if (card) {
            e.preventDefault();
            card.click();
          }
        }
      });
    }

    // Error handling
    window.handleImageError = function(img) {
      img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQwIiBoZWlnaHQ9IjE4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPgo=';
      img.alt = 'No thumbnail available';
    };

    // Enhanced scroll functions for TV
    function smoothScrollToElement(element) {
      if (!element) return;
      
      const rect = element.getBoundingClientRect();
      const elementTop = rect.top + window.pageYOffset;
      const elementHeight = rect.height;
      const windowHeight = window.innerHeight;
      const offset = (windowHeight - elementHeight) / 2;
      
      window.scrollTo({
        top: elementTop - offset,
        behavior: 'smooth'
      });
    }

    function scrollHorizontalContainer(container, direction) {
      const scrollAmount = container.clientWidth * 0.8;
      const currentScroll = container.scrollLeft;
      const newScroll = direction === 'left' 
        ? Math.max(0, currentScroll - scrollAmount)
        : currentScroll + scrollAmount;
      
      container.scrollTo({
        left: newScroll,
        behavior: 'smooth'
      });
    }

    // Global functions for onclick handlers
    window.showChannelGrid = function(channel) {
      showChannelGrid(channel);
      
      // Update TV navigation for new view
      if (tvNav.isActive) {
        setTimeout(() => {
          tvNav.updateFocusableElements();
          tvNav.focusFirst();
        }, 200);
      }
    };

    window.loadVideos = loadVideos;

    // TV-specific helper functions
    function updateTabIndices() {
      const focusableElements = document.querySelectorAll('.focusable:not(.hidden)');
      focusableElements.forEach((el, index) => {
        el.setAttribute('tabindex', index + 1);
      });
    }

    function announceForScreenReader(text) {
      // Create temporary element for screen reader announcements
      const announcement = document.createElement('div');
      announcement.setAttribute('aria-live', 'polite');
      announcement.setAttribute('aria-atomic', 'true');
      announcement.style.position = 'absolute';
      announcement.style.left = '-10000px';
      announcement.style.width = '1px';
      announcement.style.height = '1px';
      announcement.style.overflow = 'hidden';
      announcement.textContent = text;
      
      document.body.appendChild(announcement);
      setTimeout(() => document.body.removeChild(announcement), 1000);
    }

    // Enhanced view management for TV
    function showView(view) {
      elements.loadingState.classList.add('hidden');
      elements.errorState.classList.add('hidden');
      elements.channelSections.classList.toggle('hidden', view !== 'sections');
      elements.videoGridContainer.classList.toggle('hidden', view !== 'grid');
      elements.searchResults.classList.toggle('hidden', view !== 'search');
      currentView = view;

      // TV navigation updates
      if (tvNav.isActive) {
        setTimeout(() => {
          tvNav.updateFocusableElements();
          tvNav.updateNavigationIndicator();
          
          // Auto-focus appropriate element based on view
          if (view === 'sections') {
            tvNav.focusFirst();
            announceForScreenReader('Channel sections loaded');
          } else if (view === 'grid') {
            // Focus first video in grid, skip back button for faster access
            const firstVideo = document.querySelector('.video-card-grid.focusable');
            if (firstVideo) {
              const videoIndex = tvNav.focusableElements.indexOf(firstVideo);
              if (videoIndex !== -1) {
                tvNav.setFocus(videoIndex);
              }
            }
            announceForScreenReader(`${currentChannel} shows loaded`);
          } else if (view === 'search') {
            const firstResult = document.querySelector('#searchGrid .video-card-grid.focusable');
            if (firstResult) {
              const resultIndex = tvNav.focusableElements.indexOf(firstResult);
              if (resultIndex !== -1) {
                tvNav.setFocus(resultIndex);
              }
            }
            announceForScreenReader('Search results loaded');
          }
        }, 150);
      }
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

    // Handle window resize with debouncing and TV navigation updates
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (currentView === 'sections' && videos.length) {
          renderChannelSections();
        }
        
        // Update TV navigation after resize
        if (tvNav.isActive) {
          setTimeout(() => tvNav.updateFocusableElements(), 100);
        }
      }, 250);
    });

    // TV-specific enhancements
    window.addEventListener('load', () => {
      // Detect if running on Android TV
      if (isTVDevice()) {
        document.body.classList.add('tv-device');
        
        // Disable mouse cursor on TV
        document.body.style.cursor = 'none';
        
        // Show TV controls
        elements.tvControls.style.display = 'flex';
        elements.navIndicator.style.display = 'block';
        
        console.log('Android TV mode activated');
        announceForScreenReader('YouDai TV interface loaded. Use arrow keys to navigate.');
      }
    });

    // Voice search support for Android TV
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';

      recognition.onresult = function(event) {
		let transcript = event.results[0][0].transcript.trim();
		// Remove trailing punctuation like .,!? if present
		transcript = transcript.replace(/[.,!?]+$/, "");
		elements.searchBox.value = transcript;
		handleSearch();
	  };


      recognition.onerror = (event) => {
        console.error('Speech recognition error:', event.error);
      };

      // Add voice search button for TV
      if (isTVDevice()) {
        const voiceBtn = document.createElement('button');
        voiceBtn.className = 'calendar-btn focusable';
        voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
        voiceBtn.setAttribute('tabindex', '5');
        voiceBtn.onclick = () => {
          recognition.start();
          announceForScreenReader('Voice search activated. Say your search term.');
        };
        
        elements.clearFilters.parentNode.insertBefore(voiceBtn, elements.clearFilters);
      }
    }

    // Performance optimization for TV
    function optimizeForTV() {
      if (!isTVDevice()) return;

      // Reduce animation complexity on TV for better performance
      const style = document.createElement('style');
      style.textContent = `
        @media screen and (min-width: 1920px) {
          * {
            will-change: auto;
          }
          
          .video-card-horizontal,
          .video-card-grid {
            will-change: transform;
          }
          
          .focusable:focus {
            will-change: transform, box-shadow;
          }
        }
      `;
      document.head.appendChild(style);

      // Preload critical images for better TV experience
      const criticalImages = videos.slice(0, 20).map(v => getOptimalThumbnail(v));
      criticalImages.forEach(src => {
        const img = new Image();
        img.src = src;
      });
    }

    // Call TV optimization
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', optimizeForTV);
    } else {
      optimizeForTV();
    }

    // Add spatial navigation CSS if supported
    if (CSS.supports('spatial-navigation-action', 'focus')) {
      const spatialStyle = document.createElement('style');
      spatialStyle.textContent = `
        .videos-scroll, .video-grid {
          spatial-navigation-action: focus;
          spatial-navigation-contain: contain;
        }
        
        .focusable {
          spatial-navigation-action: focus;
        }
      `;
      document.head.appendChild(spatialStyle);
    }
  </script>
</body>
</html>
    